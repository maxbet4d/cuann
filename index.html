<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAXBET4D - Firebase</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <style>
  body { 
    background:#0f1224; 
    color:#fff; 
    font-family:sans-serif; 
    margin:0; 
  }
  .page { 
    display:none; 
    min-height:100vh; 
    display:flex; 
    flex-direction:column; 
    justify-content:center; 
    align-items:center; 
    text-align:center; 
    padding:20px; 
  }
  .active { display:flex; }
  input, select, button { 
    width:100%; 
    max-width:300px; 
    margin:5px 0; 
    padding:10px; 
    border-radius:6px; 
    border:1px solid #444; 
    background:#121224; 
    color:#eee; 
  }
  button { 
    background:#ffcc00; 
    color:#000; 
    font-weight:bold; 
    cursor:pointer; 
  }
  button:hover { background:#00cc66; color:#fff; }
  .section { 
    margin-top:20px; 
    padding:15px; 
    border:1px solid #333; 
    border-radius:8px; 
    background:#1a1a33; 
    width:100%; 
    max-width:350px; 
    text-align:left; 
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="page active">
  <h2>Login</h2>
  <input type="text" id="userLogin" placeholder="User ID" />
  <input type="password" id="passLogin" placeholder="Kata Sandi" />
  <button onclick="login()">Login</button>
  <p>Belum punya akun? <span style="color:#ffcc00;cursor:pointer" onclick="showPage('register')">Daftar di sini</span></p>
</div>

<!-- REGISTER -->
<div id="register" class="page">
  <h2>Daftar Akun Baru</h2>
  <form id="registerForm">
    <input type="text" id="regUserId" placeholder="User ID" required>
    <input type="email" id="regEmail" placeholder="Email" required>
    <input type="password" id="regPassword" placeholder="Kata Sandi" required>
    <input type="password" id="regConfirmPassword" placeholder="Konfirmasi Kata Sandi" required>
    <input type="text" id="regNamaRekening" placeholder="Nama Rekening" required>
    <input type="text" id="regNomorRekening" placeholder="Nomor Rekening" required>
    <input type="tel" id="regNoHP" placeholder="No HP" required>
    <select id="regBankEwallet" required>
      <option value="" disabled selected>Pilih Bank / E-Wallet</option>
      <option value="BCA">BCA</option>
      <option value="BRI">BRI</option>
      <option value="BNI">BNI</option>
      <option value="Mandiri">Mandiri</option>
      <option value="Dana">Dana</option>
      <option value="OVO">OVO</option>
      <option value="GoPay">GoPay</option>
      <option value="LinkAja">LinkAja</option>
    </select>
    <button type="submit">Daftar</button>
  </form>
  <p>Sudah punya akun? <span style="color:#ffcc00;cursor:pointer" onclick="showPage('login')">Login di sini</span></p>
</div>

<!-- USER AREA -->
<div id="userarea" class="page">
  <h2>Selamat datang!</h2>
  <p id="userData">User: - | Balance: Rp 0</p>
  <p id="bankData"></p>
  <p id="phoneData"></p>

  <div class="section">
    <h3>Deposit</h3>
    <input type="number" id="depositAmount" placeholder="Jumlah Deposit" />
    <button onclick="deposit()">Kirim Deposit</button>
  </div>

  <div class="section">
    <h3>Withdraw</h3>
    <input type="number" id="withdrawAmount" placeholder="Jumlah Withdraw" />
    <button onclick="withdraw()">Kirim Withdraw</button>
  </div>

  <button style="margin-top:20px;" onclick="logout()">Logout</button>
</div>

<script>
  // ==== Firebase Config ====
  const firebaseConfig = {
    apiKey: "ISI_API_KEY_KAMU",
    authDomain: "ISI_PROJECT.firebaseapp.com",
    projectId: "ISI_PROJECT",
    storageBucket: "ISI_PROJECT.appspot.com",
    messagingSenderId: "ISI_SENDER_ID",
    appId: "ISI_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let currentUser = null;

  // === Navigasi antar halaman ===
  function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
  }

  // === REGISTER ===
  document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const userId = document.getElementById('regUserId').value.trim();
    const email = document.getElementById('regEmail').value.trim();
    const password = document.getElementById('regPassword').value;
    const confirmPassword = document.getElementById('regConfirmPassword').value;
    const namaRekening = document.getElementById('regNamaRekening').value.trim();
    const nomorRekening = document.getElementById('regNomorRekening').value.trim();
    const noHP = document.getElementById('regNoHP').value.trim();
    const bankEwallet = document.getElementById('regBankEwallet').value;

    if (password !== confirmPassword) {
      alert("Password tidak sama!");
      return;
    }

    try {
      const docSnap = await db.collection('users').doc(userId).get();
      if (docSnap.exists) {
        alert("User ID sudah terdaftar!");
        return;
      }

      await db.collection('users').doc(userId).set({
        email, password,
        namaRekening, nomorRekening,
        noHP, bankEwallet,
        balance: 0,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      alert("Pendaftaran berhasil, silakan login.");
      showPage("login");

    } catch (err) {
      console.error(err);
      alert("Gagal daftar.");
    }
  });

  // === LOGIN ===
  async function login() {
    const user = document.getElementById('userLogin').value.trim();
    const pass = document.getElementById('passLogin').value;

    if (!user || !pass) { alert("Isi User ID & Password!"); return; }

    try {
      const docSnap = await db.collection('users').doc(user).get();
      if (!docSnap.exists) { alert("User tidak ditemukan!"); return; }

      const data = docSnap.data();
      if (data.password !== pass) { alert("Password salah!"); return; }

      currentUser = { ...data, user };
      showPage("userarea");

      updateUserInfo();

    } catch (err) {
      console.error(err);
      alert("Gagal login.");
    }
  }

  // === LOGOUT ===
  function logout() {
    currentUser = null;
    alert("Logout berhasil!");
    showPage("login");
  }

  // === UPDATE USER INFO ===
  function updateUserInfo() {
    document.getElementById("userData").innerText =
      `User: ${currentUser.user} | Balance: Rp ${currentUser.balance || 0}`;
    document.getElementById("bankData").innerText =
      `Bank: ${currentUser.namaRekening || '-'} (${currentUser.bankEwallet || '-'})`;
    document.getElementById("phoneData").innerText =
      `HP: ${currentUser.noHP || '-'}`;
  }

  // === DEPOSIT ===
  async function deposit() {
    const amount = parseInt(document.getElementById("depositAmount").value);
    if (!amount || amount <= 0) { alert("Masukkan jumlah deposit!"); return; }

    try {
      await db.collection("deposits").add({
        user: currentUser.user,
        amount,
        status: "pending",
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      // update balance langsung (opsional, bisa tunggu admin approve)
      currentUser.balance += amount;
      await db.collection("users").doc(currentUser.user).update({
        balance: currentUser.balance
      });

      alert("Deposit berhasil dikirim!");
      updateUserInfo();

    } catch (err) {
      console.error(err);
      alert("Gagal deposit.");
    }
  }

  // === WITHDRAW ===
  async function withdraw() {
    const amount = parseInt(document.getElementById("withdrawAmount").value);
    if (!amount || amount <= 0) { alert("Masukkan jumlah withdraw!"); return; }
    if (amount > currentUser.balance) { alert("Saldo tidak cukup!"); return; }

    try {
      await db.collection("withdraws").add({
        user: currentUser.user,
        amount,
        status: "pending",
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      // kurangi balance langsung (opsional, bisa tunggu admin approve)
      currentUser.balance -= amount;
      await db.collection("users").doc(currentUser.user).update({
        balance: currentUser.balance
      });

      alert("Withdraw berhasil dikirim!");
      updateUserInfo();

    } catch (err) {
      console.error(err);
      alert("Gagal withdraw.");
    }
  }
</script>
</body>
</html>
